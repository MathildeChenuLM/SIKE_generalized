/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*
* Contains encapsulation from key exchange methods, and
* a running test of a key exchange between Alice and Bob.
* Uncomment any parameters (one at the time) to run the test.
* By default, the spec parameters are selected.
*
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <math.h>
#include <gmp.h>
#include "Header.h"

int main(int argc, char const *argv[])
{	
	parameters param;
	pk PKA, PKB;
	sk SKA, SKB;
	mpz_t p;
	mpz_t alpha0, alpha1;
	mpz_t xQA0, xQA1, xPA0, xPA1, xRA0, xRA1;
	mpz_t xQB0, xQB1, xPB0, xPB1, xRB0, xRB1;
	mpz_t secret_A, secret_B;

	init_parameters( &param );
	mpz_inits( p, 
		alpha0, alpha1,
		xQA0, xQA1, xPA0, xPA1, xRA0, xRA1, 
		xQB0, xQB1, xPB0, xPB1, xRB0, xRB1, 
	 	secret_A, secret_B, NULL );

// TEST PARAMETERS AS IN SPECIFICATION, WITH PRIMES 2 AND 3.

	int lA = 2;
	int lB = 3;
	int eA = 250;
	int eB = 159;
	int f = 1;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);

	//Do NOT use prime from spec, which is not a prime.	

	set_prime( &param, p, 2, 3, 250, 159 );

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xQA0, "00097453 912E12F3 DAF32EEF FD618BD9 3D3BBBF3 99137BD3 9858CADE FAE382E4 2D6E60A6 2FD62417 AD61A14B 60DB2612 5273EC98 0981325D 86E55C45 E3BB46B1", 16);
	mpz_set_str( xQA1, "0", 16 );
	mpz_set_str( xPA0, "001F6D52 A7563BB9 356B98A1 16A0CA97 75DBB738 2EB29E24 E45299D8 939959EA EEB47FF3 113F6088 2D12103E 4B8B8CD2 B97DA146 57AE8C12 8BE82209 D2DDFCA9", 16 );
	mpz_set_str( xPA1, "002D44C3 FAD24E4C BDDC8A2D 9DE336A9 2A9912EE 6D09E2DD 5C33AB26 D60A268A C91F38E1 AF4C2D5B FA2B87DD 55C8CA60 19C6B0C0 8ED92B5A EB6C65A8 E06E53E9", 16 );
	mpz_set_str( xRA0, "00173775 ECBEC79C 78FD1ED5 FE36075A ACE1F53F 8FFB97D2 A7E80DFC 2875E77E C72D1D4A 99E13353 EC9D147B ADD96126 948A72B3 0BDD7CEB AD7B54F8 DDB5CD06", 16 );
	mpz_set_str( xRA1, "0002EAA2 24DDDA14 9BBBB908 9D2B2C47 1D068ECA 203465CE 97DBC1C8 ED0EBB0F F90E4FBE 7E266BBA 99CBAE05 1797B4D3 5D28E36C 1B1CB994 AEEED1CB 59FE5015", 16 );

	mpz_set_str( xQB0, "001E7D6E BCEEC9CF C47779AF FD696A88 A971CDF3 EC61E009 DF55CAF4 B6E01903 B2CD1A12 089C2ECE 106BDF74 5894C14D 7E39B699 7F70023E 0A23B4B3 787EF08F", 16 );
	mpz_set_str( xQB1, "0", 16 );
	mpz_set_str( xPB0, "0021B709 8B640A01 D88708B7 29837E87 0CFF9DF6 D4DF86D8 6A7409F4 1156CB5F 7B851482 2730940C 9B51E0D9 821B0A67 DD7ED98B 9793685F A2E22D6D 89D66A4E", 16 );
	mpz_set_str( xPB1, "002F37F5 75BEBBC3 3851F75B 7AB5D89F C3F07E4D F3CC5234 9804B8D1 7A17000A 42FC6C57 34B9FCFD E669730F 3E8569CE B53821D3 E8012F7F 391F5736 4F402909", 16 );
	mpz_set_str( xRB0, "000D4818 D120A24A BF48DB51 D129E6B1 F24F4BBB 2C16FACC 0C8C0632 3EEEC2FA 5B5E887E 17226417 B1907310 BFE6784F DEBBAC8C 2A9ABBE7 53F52259 A7B7D70E", 16 );
	mpz_set_str( xRB1, "0019E75F 0F03312D 22CBBF15 3747525D 89E5155B ABB8BF0C 130CB567 CA532F69 AAF57EA7 682B9957 021D9041 4433ABBE EDC233E9 08218578 1C16724C 8C356777", 16 );


// 	int strategy_3[e3-1] = {71, 38, 21, 13, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 5, 4, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1,
// 9, 5, 3, 2, 1, 1, 1, 1, 2, 1, 1, 1, 4, 2, 1, 1, 1, 2, 1, 1, 17, 9, 5, 3, 2, 1, 1, 1, 1, 2, 1, 1, 1,
// 4, 2, 1, 1, 1, 2, 1, 1, 8, 4, 2, 1, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 33, 17, 9, 5, 3, 2, 1, 1,
// 1, 1, 2, 1, 1, 1, 4, 2, 1, 1, 1, 2, 1, 1, 8, 4, 2, 1, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 16, 8, 4,
// 2, 1, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1};


// TEST PARAMETERS WITH PRIMES 3 AND 5.
/*
	int lA = 3;
	int lB = 5;
	int eA = 159;
	int eB = 108;
	int f = 116;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);

	set_prime( &param, p, lA, lB, eA, eB );

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "11888068318023817295241303549604455286887696694700154309310848892015450634489156676281877011062175515274650516825156400067277565295326931558751007412734", 10 );
	mpz_set_str( xPA1, "1642295167674679791474703314779044374237167188699995220184851062552372066527180220023014331184109063330390542318440893288636782758954954585182885467501462", 10 );
	mpz_set_str( xQA0, "766972513227126509448852431374233916512151498521956477935012833743403321016597444113599821665958825333177497243949207885209670375715197496854134809691169", 10 );
	mpz_set_str( xQA1, "1571738058391109726652979306714037889646425773715092132782510319523988452296053341430643102704462343565270589131597190566591366577345721546357913160666084", 10 );
	mpz_set_str( xRA0, "335927610670560423643631792954130585638988322551623320196529380766616858387637003653000108962218363597755158048035762500009129560556178847495291505281928", 10 );
	mpz_set_str( xRA1, "917967885586095402916765386180866679028559580491303059498624072658106646768698355723543130257343397830200614197494504924032714602593468077805425528511047", 10 );
	
	mpz_set_str( xPB0, "2590357443944749600050089893667622921629262538073948513785537858236428151118402150345309444846811365499819258231299212897839180412858520222496440691489689", 10 );
	mpz_set_str( xPB1, "489795835540284996339038925982121304410440019632949309041188048401436456449005227642993472966155709845739445130370124862146094797664695616282535382519104", 10 );
	mpz_set_str( xQB0, "2435235575802636177939040764513385497472128599446006815794628287405392169014620417174392726477966759930411730399184750155947640990440714462958596121724384", 10 );
	mpz_set_str( xQB1, "1433544764441035878276702927261570141748357750568002632450156550588638844017182728242658147665471321733994829466314100713719055773654983998784322009084327", 10 );
	mpz_set_str( xRB0, "2506396759687261050592452596671599801169987730759632924128090515190714937691366696748046536869276395008462635327607341697012449317290884277909286730854511", 10 );
	mpz_set_str( xRB1, "2237858093484271135341415091734909409650401071276910341740606094778705146500364777377669743442502906177984175564670723732093908357323680021223881169963813", 10 );
*/

// TEST PARAMETERS WITH PRIMES 3 AND 7
/*
	int lA = 3;
	int lB = 7;
	int eA = 158;
	int eB = 90;
	int f = 408;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "4854676168644306201951426803345169844108147989167300311268803792956410339798828576847800906192933777400393874132260277629616959168021560018791482625857837", 10 );
	mpz_set_str( xPA1, "5685948662894705577771037290819717118626928289142016892927166773587801769576715439745614319130946624683991097201317652750000510726166849220912003387031654", 10 );
	mpz_set_str( xQA0, "4584727927601770173820003316515475903144199640244317849730496433585852804349754507942656680091259016861981421802041033825077410589575601264782892682969356", 10 );
	mpz_set_str( xQA1, "4225080316811771915682515460329934234253752396269940381722287798592250501671633450252361354455769377915170861549243751427690666689439906910324148283450399", 10 );
	mpz_set_str( xRA0, "1010751595976610708438970960283524541889763252059014850652413503087106488663484905838398233991294573418809598613371359249951922002304160097727522293996461", 10 );
	mpz_set_str( xRA1, "8383747922619331137307881900752953985676831133167536491891719187612598763593315430537455545074264105936248656153084339711499258679198634703359741764667271", 10 );
	
	mpz_set_str( xPB0, "2735142480857501398806123948064733614683256778904190566349611883024523190748586093715318746014111878623099079210948559008199799111585275758435665053650524", 10 );
	mpz_set_str( xPB1, "11091197967177464606746010528451596521245078626953293602032390107941290522854563492802360349886167840815400086325408918729521728406034135493388097175641609", 10 );
	mpz_set_str( xQB0, "1601641581693702493965187641402694943735991479015963039299296774643326511354549578212444180569848387254438388143134929538356134980821238595308884276006246", 10 );
	mpz_set_str( xQB1, "726138737383142020139099844008068258843438117386930609916472195622897367327590568060079609266146038859588210796260085952160949220666788079111170124150039", 10 );
	mpz_set_str( xRB0, "8720638211677219964961840132999988442452128946932745428281971339935376090470733563444770745081315022311894226923919257764548085468642150516476044800441931", 10 );
	mpz_set_str( xRB1, "6931918108812537855604412838771426007615727756860744606051944276688207599113834444803941172004287358758941813243703819655140591754999283590791062437475965", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 3 AND 11
// WATCH OUT ! This test won't give the right answer, for Sage couldn't find
// any torsion point. (Why ?). Useful to get permformance though.
/*
	int lA = 3;
	int lB = 11;
	int eA = 158;
	int eB = 73;
	int f = 192;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "7041095740355170643069374637124889657691891864696969066347008972890464234030491141148037730270527603885419254651002468387586565784737577747877807616535336", 10 );
	mpz_set_str( xPA1, "1252125553489671001016859407209672605913014639186693858672788319366771665010396467321266546207200447646111818677351259293046612584357965505964162665988863", 10 );
	mpz_set_str( xQA0, "3661910707119052138671297632755511180888740398269462728909482538033796513922072381786996836837680175112886795795792375321862483329407392430166760443742759", 10 );
	mpz_set_str( xQA1, "4358661110991227860490650478783694142095158693425415176779803730217647392885547887703868688859363387019986992135967184911848011400205203852462564346553711", 10 );
	mpz_set_str( xRA0, "415364755169427924359357819559138730203735263017195006707242071509570308055727750832045595036618154148379194053274430247806124157987606006582969876094277", 10 );
	mpz_set_str( xRA1, "6077338830123567966632184297690090847568988025872460680100772315644864553532003555601402209189715095910039324123619219985014866946904133809580119708123075", 10 );
	
	mpz_set_str( xPB0, "1426622420970038001705362143201398027512111179623515828705820541550989465360018320710993987339362342207217575037519637070880527434650837618575504241289687", 10 );
	mpz_set_str( xPB1, "5194564287128885430430227535285720120236143132924591005880615153880554690175499826537946792246150832257150112223449490833998793440907706103362689614765942", 10 );
	mpz_set_str( xQB0, "2474585405209371705485335435709790956638145593951308051826052224228310235486718551818594418119429168455029976665157580868816840800422717162827836642123899", 10 );
	mpz_set_str( xQB1, "6624877116892598032072288256868227899524129889826863310861151890675986875096728388858473539470124050487793477773639651470382039387520771591098412914599267", 10 );
	mpz_set_str( xRB0, "1212322112566906363830457347122724409613165148976938804106310794491091427581121599046746040107493856856485304359822484712372072924837443090335512291113314", 10 );
	mpz_set_str( xRB1, "3802728057096730673423500615864546211812029068790096723487238006865369711835320434308673374398363557998663666080597328675053026451333191102885425364513815", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 3 AND 13
/*
	int lA = 3;
	int lB = 13;
	int eA = 158;
	int eB = 68;
	int f = 8;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "45795237098494518934642711526847529636852796640349180010895789673101674176528992565935221159278057812315660420886547596598477238447336369432473588727334", 10 );
	mpz_set_str( xPA1, "89766415951067895898185238577370304383504377840378706777324554532680067407644141713394802227748925509989576909012429857585873384441494792986125358622909", 10 );
	mpz_set_str( xQA0, "16885836812965600972653913150635760042327145106571365807371913313807440556482516439445515812956438033787147496330161455513424151444009044493213908540644", 10 );
	mpz_set_str( xQA1, "74280988383633780766405085114637867733747319948209791137873976497226881911871739831237163769129202976312029723834490431083009365186569506102799936464819", 10 );
	mpz_set_str( xRA0, "98427465892557742051878437820770431896739273640693707366690137689829454607419129293353573852145748210446387672366692882412302210151806509624265144760487", 10 );
	mpz_set_str( xRA1, "99602300512088891645065319390210037932326096716133585782297106637827995725636003186646708865342810602168558167991124988633497958731019092906826704831558", 10 );
	
	mpz_set_str( xPB0, "21544695900437488441698811581024888704129283659223577988226011148893009869647544536981711862408759635394560437407691200204700612508915515151180276178060", 10 );
	mpz_set_str( xPB1, "83232420219246435080868909136226036875166350788268997339907218044442145813406785148328546611380045823644550711778444102751422098055328075063239267622392", 10 );
	mpz_set_str( xQB0, "43028001618199710505996985980434979427496984650624722839082754102246618926614345039256016015421095592155043914772967589925015068243267752463370622444241", 10 );
	mpz_set_str( xQB1, "15873735099631613966855764394858872451896070896762903737302024062302064152524942362719377121885295547402714444600303980584340149232892511914906953016028", 10 );
	mpz_set_str( xRB0, "76425987754565832629388421157220797176607650013092436829869590509836580743121217033211324343817750818934113837776930765284808340980905454684460530115678", 10 );
	mpz_set_str( xRB1, "44106300274095131703672136971169802103200142422880041621382191154530752108062788476055605449671244835902766992549024205621868550184542159453482698386784", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 3 AND 17
/*
	int lA = 3;
	int lB = 17;
	int eA = 158;
	int eB = 62;
	int f = 440;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "4000499664115488148687382982417232969049574424622681436573168187020710708067313092200560722453520129149063482518844767316036272856011151613351313990982670", 10 );
	mpz_set_str( xPA1, "5388000044145441248272618945739526012445980263764129794161306601127414057027535870532263899605355103914832559782777758622698162487164770383745345225553889", 10 );
	mpz_set_str( xQA0, "7010867106153349000237765725714297958138576564616770552833851327399126826647828140104837253840059768196402850225480791061192307420138476149197542183343431", 10 );
	mpz_set_str( xQA1, "5619113077150996719559550529852078038762655819074615043659780383109929569044539233137435943589316272859420457825205421037127881210293208073337211199270330", 10 );
	mpz_set_str( xRA0, "1289609983055538969447798428808420270471450650675233665629712680996571875383949840907250090557614599843679132138305079555187507632569722998838909880518271", 10 );
	mpz_set_str( xRA1, "6569452393989570551862577889382997216214910711069967736246890363178123111959203824365942898562453519588582066661932643926688434244737685811763244382803913", 10 );
	
	mpz_set_str( xPB0, "3069477275887442225817168830764248832463414075265162383653688395733124487222809145313561137688512054513468228159342661261638699530510293999870777611465048", 10 );
	mpz_set_str( xPB1, "6533960902346949472829608055696492611128561234186053705315465530361926791449407810221384821025533727003406869786156639624777030137711761752355918560188825", 10 );
	mpz_set_str( xQB0, "5267672492541194421785233732696317508308650167383466349713651464126586597047634902990336610468296009608514616475312364940074356607145485245859473163551536", 10 );
	mpz_set_str( xQB1, "9506374743807480514463966666173245247573655329747928366069324389482223316942217159165134551128147016003031431991195239097913448630728353109765513683538699", 10 );
	mpz_set_str( xRB0, "13264817538408443464678968259450701900270295569483280136472896978352553057445831666472403298440147208336922643031636015578102317213244130008121273747087268", 10 );
	mpz_set_str( xRB1, "12236629007323705272927817987617447970022233674038553727228175222965298833024240381788535141646569986385049690037398045168060917325367862272918489557371249", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 3 AND 19
/*
	int lA = 3;
	int lB = 19;
	int eA = 159;
	int eB = 59;
	int f = 220;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "4290674199782415456190801891853330631984669450636723033464983027609560636780733663447470035603006277164580867477210554415180436459980434565311006389220140", 10 );
	mpz_set_str( xPA1, "317562140729539152411995571563423734617567117513890227886165760405580113002303194729476942921658949714472367742461309168888341898059847478879994698360825", 10 );
	mpz_set_str( xQA0, "3219204890739089467395284614784655267835009319471072609982744524176611985956273061161807892719762752914985506556751337603961139333461958917049708963466539", 10 );
	mpz_set_str( xQA1, "3155454807999551157277890979975074059093741353524072667187339574371986207604593759375094548758935824769914820170845505370379114914523271055194622007112317", 10 );
	mpz_set_str( xRA0, "3543521004989536393565402474356724716846334612867490780324816337309469277633156424882770207108231907575167347187117568426851884593578730048446582988549312", 10 );
	mpz_set_str( xRA1, "950969994738143308279337373213369349866274583348477109016577328423938539060074516592269249369085825267403391842817167419848204084402631355295729826372978", 10 );
	
	mpz_set_str( xPB0, "2852179983837283913484376180508412019132085146096430881574865993708636487867713830232335023261552777911520576865255713587888393741948226874050997118047610", 10 );
	mpz_set_str( xPB1, "199234498246967117209273205519101072648206544407256346847410683675046477055865142525086460293519685601583426831419843351406189183274506322130611642325354", 10 );
	mpz_set_str( xQB0, "1840924843397729322765987268187710630425717812614881626860135511032738537717744190425733280474899100462758907082008004001790750339215598672901725325314710", 10 );
	mpz_set_str( xQB1, "1731733958555584384525109192882280620249562993482796675363490949682710188843972466919001159144690939886917181955390123157158492797312308675602016746077297", 10 );
	mpz_set_str( xRB0, "2907272888599210438312558773370083579440756180999960727240877346253225649681854168907416016589465024426074523971017186394666909847720717703838276398262136", 10 );
	mpz_set_str( xRB1, "2126736817055294640274837689224284427489673592918089110005374194843129340513336031771865751724206545374741760571682473376757591222742586577929228327957613", 10 );
*/

// TEST PARAMETERS WITH PRIMES 5 AND 7
/*
	int lA = 5;
	int lB = 7;
	int eA = 108;
	int eB = 90;
	int f = 152;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "1585987040130225087921633323898130664748302110256625474807433529241740394511674892674486403738656940882802598445366232849593270671699850599170387899461881", 10 );
	mpz_set_str( xPA1, "5268182929064097672995556872246877998164967879518983299758951033334366800771437141731189123700125192093423132567620140940432931296837170392777781416688336", 10 );
	mpz_set_str( xQA0, "1156831299601862149947723338316020158544524080329302458563048534820856609460981231215532793282064134423410094593558469907480182844067246199897988877444966", 10 );
	mpz_set_str( xQA1, "4693723506554056077902617536772780159834581920037911242557363119732807479506585577326802279195662795585643700982982845048598432508077271808270616009027981", 10 );
	mpz_set_str( xRA0, "4293933137890766177986692372888508291634021598822365053190047046275419545141206115000758335480383848021062618383446713045805156629055327011446763078391825", 10 );
	mpz_set_str( xRA1, "600037124589920488616560029668590693140734812825922544580907711650240054442432125255509256003489916803282817714927712089716552990120849547596907064798874", 10 );
	
	mpz_set_str( xPB0, "1822117537437948416463392822676994239747514759287965077142084010346629593742893921332792569513712220187589174222196664309674525457428397461950137007173198", 10 );
	mpz_set_str( xPB1, "5164024922634972101363750799281489237480926911726472165468133544302606496775884686123961973219125699343162263553788706738730855287638400392897021777478115", 10 );
	mpz_set_str( xQB0, "2812216799507969400079228399713582373138247986963765665462084392415222465136422293877197275502101875781476527515618702248541887981146511240326097435528901", 10 );
	mpz_set_str( xQB1, "3073670035724704042474083416101708125108352035135378081241914923457733950334043229126862799198176148337930730381913641664941611757399360098423607686071357", 10 );
	mpz_set_str( xRB0, "4148915554934553278846642417990173392757380099808801060221823270861142229426534606133672894916172285901771637447261935176889903565259497312264503062741046", 10 );
	mpz_set_str( xRB1, "4327364999380403465525818953392300771828564592088361808160823426701723018190061181758626779964408850588898918317541708663617278235461192153660576706441264", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 5 AND 11
/*
	int lA = 5;
	int lB = 11;
	int eA = 108;
	int eB = 73;
	int f = 316;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "8083632503652173468705284957963563527882795299428388940079762151161940782880865255143633584688209940076560174842562416363532965306909717595267308156170190", 10 );
	mpz_set_str( xPA1, "1395739589655309812870839686990597060617285434674948651657259328476968147455262226269981777768771273069863761650793259850089510988425263217755505330656615", 10 );
	mpz_set_str( xQA0, "1847624409145267903257155714979364251202215455012581221149080294401638227922714651063028250430034624141737460919824688080976806327321183820230673759390577", 10 );
	mpz_set_str( xQA1, "3450598140590825260576734709984715194823604098517283463937794218768818263707263510812846774353907112998874489605386592057317331039141037926356137730820031", 10 );
	mpz_set_str( xRA0, "4367104601624799661823542938404437933724042914641068600217244446017347425839309897287838131583826327308287553632366432910969857061572224335413231161571548", 10 );
	mpz_set_str( xRA1, "754663627305492908227254807019395725843612088007759551829591445600000749121866644163689100250132335755786133521907092203730235861788207482159982117124235", 10 );
	
	mpz_set_str( xPB0, "791193368464075577579499125425282827992032107651892334954192180364707610735209856107011441022811710990776541938027113369396121481004329027847398367312340", 10 );
	mpz_set_str( xPB1, "967865803100108833622757783133089686981198904516358358033090934879507235584207204405093327907684440806533461961718133246541330059534334400715977526466315", 10 );
	mpz_set_str( xQB0, "3058788951712882248143998271862625795861689213170452044145501418222705318374504932220391846931828039939874933496178943444737214086751241020575025330748409", 10 );
	mpz_set_str( xQB1, "2085276743617139086722946579154848618859840714784735595031672731944720760759654042398606488754582052002460921701192938401380506147596344964514212488324934", 10 );
	mpz_set_str( xRB0, "7088551974891522856430874031251698263967591808911426190335685395663838222823555683369837676645378850818013877405783004916363123037461322445218746442154105", 10 );
	mpz_set_str( xRB1, "6749701094818586727075352316741726385400364387221004342047739149003581321638922071582594605296203384081732083851420911444367595742999372873740795602180539", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 5 AND 13
/*
	int lA = 5;
	int lB = 13;
	int eA = 108;
	int eB = 68;
	int f = 1836;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "13870362347860321375686976055409330807516943264075883146127032205184406483229907572899144129681030198000236474749243760251278456229261926165599567263850982", 10 );
	mpz_set_str( xPA1, "26155721544438538065915624902804018052991181993181654665017689009840217995220775476052209866505174393617550123575155885352036867546909545753141879254140634", 10 );
	mpz_set_str( xQA0, "26482252184059261306531160347397842620324189055349718567666510673432960281921252682737139253091169685579301089122328775844950819569519372772866423424681210", 10 );
	mpz_set_str( xQA1, "717840576367235026184906791470717603614827800775816835855933431691749578227652051969966499954711326869369691355440027665407402150488236550122573934532034", 10 );
	mpz_set_str( xRA0, "9183694309503559986065072619839518344933606016019054662576816229176938241952973181952475350824006326404992209926571175999028770288272377209220863180564911", 10 );
	mpz_set_str( xRA1, "1320101359176386760027089402957324162511187200091706366170452111745046481932880419765656815187052226464855251651603426688290716735249980213256440769977968", 10 );
	
	mpz_set_str( xPB0, "19696618580801795724326761420125055425476578865703603775669654373616694262404686702979283216468655590911922288383818906328296605854154754380571863065850335", 10 );
	mpz_set_str( xPB1, "5338966415456531568007044281893238507263834974056273723424326470091951323579128005520608226189141223763717650706102626792960408786914517195777174537714150", 10 );
	mpz_set_str( xQB0, "3057181854155048109137042589018940903393106678035704161658956683467285345108451919289829520029381306019643247649744735601471696326257795124458709861700506", 10 );
	mpz_set_str( xQB1, "14609017601726863963909754304328030393487430927496978841104760931091111323510937755156148616502861586112127065398653713632148643462141364119789960194499311", 10 );
	mpz_set_str( xRB0, "22446777519960334094070413041254910427231168550280980893696072379600692493598711652684279498036036470843147619366939090879995832721988088068118017784345521", 10 );
	mpz_set_str( xRB1, "2822614323430655622491034899171928826147051964680148362660883251384536213308931616874702762730566866082083229131295317031469514317074216561364460584482785", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 5 AND 17
/*
	int lA = 5;
	int lB = 17;
	int eA = 108;
	int eB = 62;
	int f = 132;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "2464476739612580228992049087737075930659153975310458141389309202573355914643117640281111449550678854221851194822871637356483890383299438172834812241281347", 10 );
	mpz_set_str( xPA1, "4031261135492231049749245496000579980134326926590502570294377562200945743174194048721178843525263468803361555612754981724286005094716554163585171534380980", 10 );
	mpz_set_str( xQA0, "1275249344482451057584620530409235516661186222813779504459750044154330258143050196632015511572942991764313190085422121684253937824060047908887558879188323", 10 );
	mpz_set_str( xQA1, "7145899332359463877813258415592260253290707497530915236753624001999770081310685293838059550235026515049325407456742463737356718628987254575623568488747466", 10 );
	mpz_set_str( xRA0, "3753374945299409247605004712554438646320403153349747398884076860333928135708770237570488425480819038811284451837078584658272259734811410780870794616248751", 10 );
	mpz_set_str( xRA1, "6190668952794398844022687990122548036529672015023138558481299650425201653788404733177862440209279171077220614207207622570394195229460321994411348685159878", 10 );
	
	mpz_set_str( xPB0, "3322694800220015295630297069438214483752781284061988764388142902143379190738110625714533987293278793675089248981974161863414402948229313041389310032206258", 10 );
	mpz_set_str( xPB1, "4136857699585337111255583793802611915721874923196767264772163046864792250360165729575222227309846417862145308685893928574380863957789709896875564139036384", 10 );
	mpz_set_str( xQB0, "7525863231276131214333352220457805861428750976030839760452207166257282172423740881512201408404632448862389322179314423827080894656840731852954737359364531", 10 );
	mpz_set_str( xQB1, "6196351782702885032528412610283095588438335036783294063591243852771361378159916155905283380298091375774118350610568155136303148811232419874100753161896529", 10 );
	mpz_set_str( xRB0, "1087093148632658197817240704612437967968407001006156861713227420294405462726969360630111508938240666104993541575163970308565034642639588567837417974884923", 10 );
	mpz_set_str( xRB1, "2365936647423758723933706388723762443878508541549587647599282499018609275544751727422965602892079560571283239440996943038158245955539103192314130837431936", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 5 AND 19
/*
	int lA = 5;
	int lB = 19;
	int eA = 108;
	int eB = 60;
	int f = 60;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "8892953984569273853416533203085061610291126152604101687465264311490375309885468564412252513324825648554323094968774510670027303399698960295235971266025085", 10 );
	mpz_set_str( xPA1, "9448530419437059560540371548638894035150091578377742355367360467528334421491588949748216032027520547726983530963647071069664492885943421488543087828915441", 10 );
	mpz_set_str( xQA0, "9401613594826267108679756864282641662251076757008344210460742152297514839444260334802130658706900972297551448360969657952879131834106277004563090462584127", 10 );
	mpz_set_str( xQA1, "1470518613056419576011789341739707959427781654206049269951683854654899379028696986195529760046408139862362703154157023806866693454818156120244765647388176", 10 );
	mpz_set_str( xRA0, "5257422477994264389182616710637088410821064168010801858773465669044657233011598117137868215258967938742691562493730101667196589999756509460123529252456338", 10 );
	mpz_set_str( xRA1, "3236925299200482352836591161363012759907114899952862295875688716380259194120515250841872863075910140004545942657902727509306079400784590587839213788876259", 10 );
	
	mpz_set_str( xPB0, "4883072525005981094963011045061525547449891147942848131687747263880611023515075875898819980105641861245159108195567928337325052439038945901910188128727667", 10 );
	mpz_set_str( xPB1, "5555437039978063550838692662475358375699924388481542628615740124586287030383962339033483571033503574318745324996536090441900904944435414014106673576407004", 10 );
	mpz_set_str( xQB0, "2661727327739076377352779804014035976238628458448133834218046750446947432354656469767698219097342655377338190533416344393028708416288030271961247761458889", 10 );
	mpz_set_str( xQB1, "693219916882155800102854051748752920007994051155309460672398497649062520934817276827422193458109664111078634049853830537222993595571101415822990760360233", 10 );
	mpz_set_str( xRB0, "5995328692747552331264455968081805560488741877099105265948415296144689018024460088504930309075633977111238940413185152499170627373992290265704637891366937", 10 );
	mpz_set_str( xRB1, "6431986094647225872406864903104698295137014044204739710915387903434483210894082810862446837822116425797864804217574101575207314637516195558554472183919407", 10 );	
*/

// TEST PARAMETERS WITH PRIMES 7 AND 11
/*
	int lA = 7;
	int lB = 11;
	int eA = 89;
	int eB = 73;
	int f = 264;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "2836820457199604039847200498981354447467538267057586288973691012914088189500780428402665221712793592158109449127064099672859481204069725716974797326182525", 10 );
	mpz_set_str( xPA1, "4337357814454973940048844759163576703395110500407800856533484766704654308588961559201049624710385232951951063746297889382154491602824404480149493102309361", 10 );
	mpz_set_str( xQA0, "3071994544672076311114440966385441319960144678788606905948122098038432758931376427295681232737490047076141858802841905454199592171527544819815899448041818", 10 );
	mpz_set_str( xQA1, "3710585851724809236770218129556774206029514084052327993510151074104145303876427829137277101336509398966404965515140598955008166906244930551009238223839149", 10 );
	mpz_set_str( xRA0, "2315145065690990909894287358452356776752749202047590297394862755276027767640535075743281899262924219898999759326594309567978411149443461582673164994666371", 10 );
	mpz_set_str( xRA1, "341536511316060098922995187152766324702774062259411347984992177838534596261997518243663286083411429299159719519816326897383207568299041629323506626514085", 10 );
	
	mpz_set_str( xPB0, "235077275567756642140001835049319892551651449579051995732953104832832548660672194148593019088273036516820810588469962572548402611052581871959138420807557", 10 );
	mpz_set_str( xPB1, "3153124433196367592864294993178470951388760699938672614052488542375584131113441871579798409341906144567304562756295043940749530402334349212356867526185407", 10 );
	mpz_set_str( xQB0, "3480438492039221518153358379118699254784582234891753768515320491067982178890272683573927359403808709410139049988622805674347238741346815360262614413600945", 10 );
	mpz_set_str( xQB1, "2824836343950316462545511151718757785375813742725015779991057608659614936057313232788448611464601171028309425415934719608668613638113069354005947742541978", 10 );
	mpz_set_str( xRB0, "1762321834780117608731053003009778164080500480166968926783336766896825288398153459014339945347836409513689382884004024885801909537876496227278250646037696", 10 );
	mpz_set_str( xRB1, "1149047732019422429130391942073368437612807868106133904299897800716285038773098455150701096086040303844479290281148269589472230743245258629155025659197905", 10 );
*/

// TEST PARAMETERS WITH PRIMES 7 AND 13
// WATCH OUT ! This test won't give the right answer, for Sage couldn't find
// any torsion point. (Why ?). Useful to get permformance though.
/*
	int lA = 7;
	int lB = 13;
	int eA = 90;
	int eB = 68;
	int f = 636;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "24486169891509358760618372438020153156160610401378571334472969661910214758910642555786256099227500824606564740448134146299113533802234217876652497707827801", 10 );
	mpz_set_str( xPA1, "39654940158209997883038303298045915299079736256854863478838461650162349483553850663427369859655978917949538298395894354913294054782146354106157002858322990", 10 );
	mpz_set_str( xQA0, "35958200239051275107980387985858363563458359530777050762511779422417140437640067585431111428841850248621131186459890158745007818559752505165262128553448446", 10 );
	mpz_set_str( xQA1, "24486169891509358760618372438020153156160610401378571334472969661910214758910642555786256099227500824606564740448134146299113533802234217876652497707827801", 10 );
	mpz_set_str( xRA0, "1543559291341185503301222913523389165979138516732775487725883539778281579251416021223504796135648821066721748564799681671766288935338337988827755103356511", 10 );
	mpz_set_str( xRA1, "20896495901619473092100748800513718377551603635874630486091845244642681516932654268515913532806652315818667726340289109255546684913683392112319925965821681", 10 );
	
	mpz_set_str( xPB0, "10069480109636572102333213355543790593529193018260809634547328517794902805125343000702386159641307762952279469040351235713840176638471291307347458199672382", 10 );
	mpz_set_str( xPB1, "40677182388142948212605659015936300951542040262217166822316343949924772244208444158584628490370805254196888632409641475575234936953329501863264464666082280", 10 );
	mpz_set_str( xQB0, "11622319471378312205536560815824308688407430586781702015564584226934903306632296439853295054016315810278895135533347184334695827095767030995312325828878652", 10 );
	mpz_set_str( xQB1, "28205211399624186157759025292144107920501515243239078161657348004776154351758959845462417849200545692619823367163014003045738919256267783854278392747562423", 10 );
	mpz_set_str( xRB0, "40386775624356245093281954122620865215555277870196190183110650961224785224200784382338381966843054646268789350700720840600685372344610340897406804289402189", 10 );
	mpz_set_str( xRB1, "40372109129926478958723929997483611398646982060851468610135063088493096850232127044359224882040271193205543415832545744813180313268677223183489557707623287", 10 );
*/

// TEST PARAMETERS WITH PRIMES 7 AND 17
/*
	int lA = 7;
	int lB = 17;
	int eA = 89;
	int eB = 62;
	int f = 456;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "13777211806207013098498023610178540146835155447670688129377463379412757862280024740940507673510439488429806845740419039675852919657177477716406285546967699", 10 );
	mpz_set_str( xPA1, "8094243811081355593817113933147072480348087341236479277007751738396949138194255857728389882466761978211071667389977841594979304568882553062492039897697181", 10 );
	mpz_set_str( xQA0, "8227572628621579745382531701432949631570910961334950172266228088929815653311692020370072654225742357292640237112731850804211846351101651419143568550734934", 10 );
	mpz_set_str( xQA1, "716793397973089486012231698168487195789368771291750895648223050007876599240892830632241595463747429258285941860379340955474175448181286406449728294160337", 10 );
	mpz_set_str( xRA0, "8453285480045761433451960222621966438692595060696490412440729658061349900013326212269239002809284713674914215836212907343808917719987242086763162816481938", 10 );
	mpz_set_str( xRA1, "5894731372684096050796477515553289424711824563176352845596930495140541880240449248475214147756557170344463654472622328685417072859332242578325184960028932", 10 );
	
	mpz_set_str( xPB0, "2559691119591399070910417884650070879269904145366553448532102754628225496014071642861129084787079303979720028893092774468973104114160735157975889820279637", 10 );
	mpz_set_str( xPB1, "8689725766203658309798415260014453047964831284430545719988186279663001882390610661061472330452807779189202874916327449099993336648114877948871263524698955", 10 );
	mpz_set_str( xQB0, "12225554336753748145299231420455952432729070837210576255548339449484208556342053620873643795321090407785373120093257878639848244513066669293084985409127393", 10 );
	mpz_set_str( xQB1, "4163799417862442553524042728820629683860937839308352720243259184271421064648909406545218460112562991106603348601671896328320936942430255814299609285646437", 10 );
	mpz_set_str( xRB0, "6977861819463760914055363974691241194021815601113036612259864983963148538614420334085851068636585393674295397514444092073385161404432636729368450461011761", 10 );
	mpz_set_str( xRB1, "282343928773633480501123280349574798573833269127660307933993366563366398180750655481368573659324257798064391587218906529582756840608031925372460174975468", 10 );
*/

// TEST PARAMETERS WITH PRIMES 7 AND 19
/*
	int lA = 7;
	int lB = 19;
	int eA = 90;
	int eB = 59;
	int f = 600;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "14401957069522678387594814558469623044667704323881748378081302666974726778437406866217936049959331021239854137538954926818684298055799479797421819415930748", 10 );
	mpz_set_str( xPA1, "6886809005256268293898839470764227036315768075075829566165357104242387101602399882550898614227992939933440191397013834502021943985103170941053695029115818", 10 );
	mpz_set_str( xQA0, "981853772444796998844909058170952645560665699700981595774676544176442879186250052273769360135148256132883020608259516636037476976907815461664939803611636", 10 );
	mpz_set_str( xQA1, "12752769205180348778925424276543812597521731111834658015752946173942408450481721905674201793922668456691700227113667716890369137778611620483244298228679266", 10 );
	mpz_set_str( xRA0, "19050182415670648813949754904075680270102695368169621781507662942256550425292423107424164257365600173943962076173431168401274777494941592340794596282714142", 10 );
	mpz_set_str( xRA1, "4374955848449372632068642678182432302375557300702732189500823124928465066759743258097560003706805390366575548277148962536016461882049827601072587000409379", 10 );
	
	mpz_set_str( xPB0, "18774888904772840754268200918774833527635185229050796078125639219365942778158046210104400970477421938018084562149457435613211020483942340519214709752308383", 10 );
	mpz_set_str( xPB1, "13928087458075731274765697768924338729211917927145859622236896224843080265145594569885006604624077709129564946633524673547373405166403786193929084941836856", 10 );
	mpz_set_str( xQB0, "10403585102754153579272324988625354004695288194276817517586261731124166756364571117860391085129950044489395137898852048363599072165148458794133211233474612", 10 );
	mpz_set_str( xQB1, "11417913630309607770531745782823670038797826652835618149860532237963545063016041742764641849016967035277671329516246096424537248702877625340018275649992431", 10 );
	mpz_set_str( xRB0, "164967493416479473199593330310710240215058784757631303340937160170218919213623896703234024906481037550593302711004701532758677749079880872997938697267976", 10 );
	mpz_set_str( xRB1, "4537115304540023268633115788912098577800003587052002649723637671485117077386538208296541914858668659563567221058786227027560634483908236301347309971755992", 10 );
*/

// TEST PARAMETERS WITH PRIMES 11 AND 13
/*
	int lA = 11;
	int lB = 13;
	int eA = 73;
	int eB = 68;
	int f = 220;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "8383573079917600157962735824712918020328166992766185986339206119615023276591574882257058125349244973091933451979155646418229526827070438930037757598218521", 10 );
	mpz_set_str( xPA1, "8383051396387543532297549924272542217080552013153436316719881930943757360863044905575481716524111528844980204153984671128688904429840648531929018267846070", 10 );
	mpz_set_str( xQA0, "946190675104579374288887218120533216940088937313797198968886317373443834303347883933942013216447592057715696323088873445902828689483777282246959777881468", 10 );
	mpz_set_str( xQA1, "9279349668934151640427839548498112516225411336847020241604927609490460006468259268201207886560871100769563503803564334690979401309519229730731324569157450", 10 );
	mpz_set_str( xRA0, "7902692440904514825403947567439024835999843240280164738657324167736399696053696042595433580878693114385118257117068279530650277300136457123916941383390697", 10 );
	mpz_set_str( xRA1, "8324445878710589063898883870119456033500692878954974622611183582021598058800108456304843827073476175390420441210308928077168022791327196857310919382373695", 10 );
	
	mpz_set_str( xPB0, "5183195872660186572894862167604624084905970682252316569269101264363907263159668093750633143214582356998487338438778066095684469713059286308247355770931881", 10 );
	mpz_set_str( xPB1, "4097793668978129016341382441411671561891901266454019646981662849044336930292371330288327928594995998600229446050661147519249534814894770788347140467757496", 10 );
	mpz_set_str( xQB0, "12110108666888124054663400269714941012546843120709900558993711345498795864012223100095072741011079477388697285440859437477305031168899708239844157232753910", 10 );
	mpz_set_str( xQB1, "19932229743379578078841569279555404999357997653027158813906070138736552725034280937439228631227920973482180989157803355810383274884274803876400930980457", 10 );
	mpz_set_str( xRB0, "5319920938903627634585836096082532130458058949589294971391877209055504118129050457509754310344191846605440741204795138234952767974121774828877182484431506", 10 );
	mpz_set_str( xRB1, "3082945369746664513425374217681019140029176517312578754052948642216156381153512550115972858447269191150471495703606311335106803873500198053031805801315007", 10 );
*/

// TEST PARAMETERS WITH PRIMES 11 AND 17
/*
	int lA = 11;
	int lB = 17;
	int eA = 73;
	int eB = 62;
	int f = 1116;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "57085806162540160940715382615472482668875084251702232110884721444922302061877750279870235812647420759920389408077134821010919386791089921190499107214916798", 10 );
	mpz_set_str( xPA1, "107115792206820627742826187959361329385080440915347278453710479638726653933653457289764032611042788381095365788656491649355496887156535180498291313531370051", 10 );
	mpz_set_str( xQA0, "206447749362138113375925847128555015466171756410709526107922987146103681315734436344520300062079183192027731722638761348636121643810789730345916002990587493", 10 );
	mpz_set_str( xQA1, "14966433325353911664921002768000388833017377456498224449775560735087808310775256718796123999335137128629027191018269029298177287636735515194191207875370538", 10 );
	mpz_set_str( xRA0, "69094539283963197537592902885396385999661867277409215840904604524936394456985907767888840219082045787819752601803052003006002228498309366446711326669935674", 10 );
	mpz_set_str( xRA1, "206226899552931912110590859979584922493829136019456301130292466711077349645053874803625839758490128623943747740391054088006767519111080388403502216380751395", 10 );
	
	mpz_set_str( xPB0, "215648671350686462904347555934178351005924520942134557679088577747737633895760739081768955673449641042189177190991154246724892393173284076996429945908980112", 10 );
	mpz_set_str( xPB1, "115523781802688714042810594349140999487579621553496319736983050174890125578706752869484475340036655438776703625811600271857072738438705383575931694733863075", 10 );
	mpz_set_str( xQB0, "172452222109633616661043084467447725831159824127420949077249304256853555056458149065948431917714037417328366259400779034869192094832473889774577485839196615", 10 );
	mpz_set_str( xQB1, "73016155078877897847621161999648070526673398205027100153052707572449697396340393803914825508445643396667165032982346488755599898927692969259831248556734511", 10 );
	mpz_set_str( xRB0, "218533678596054134744211087470511886059565667854268726511492244407581131951448700633775213772541241955312806903838002727366942757638374418092583323749424420", 10 );
	mpz_set_str( xRB1, "168230549202306783481154629510489562185566869405307170776078307616672544959134062638081926812686636131364909194994095272541218982108764610526375615300005513", 10 );
*/

// TEST PARAMETERS WITH PRIMES 11 AND 19
/*
	int lA = 11;
	int lB = 19;
	int eA = 73;
	int eB = 59;
	int f = 216;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "4370528883974336902700731860288359964655636549474714706742743676630207016298286843993098249082789033262523323975495172312064774948904035206425887930258128", 10 );
	mpz_set_str( xPA1, "3291877248803167184569784502758731626833382816044058853921517741133980987053022635666737085365649109474978301508643994447099790516234451645404443086259373", 10 );
	mpz_set_str( xQA0, "2777244435218475065432014034615399511349325785430506261568218051149141405771541581098653153935549680001013627824407698318234673681200944275433800821252479", 10 );
	mpz_set_str( xQA1, "4731816630051291197803399090884827715420771987108470140167816805164489291472586762261593451896425574971705400866828929616683649261787041198046551130724654", 10 );
	mpz_set_str( xRA0, "214591600759323090299270969555422391999338690168463353207822102144750605187789066726220333384712567997168276375736406828062051241210878451103620274000458", 10 );
	mpz_set_str( xRA1, "3071103637979192236667605756025100782041744090154780091693968099121935891074311175699572608654327573081224207434909817766523922757862198453735757286115153", 10 );
	
	mpz_set_str( xPB0, "1152204993742098645127264712921834143148887337367129877692045484489400339466610881914949915732165675495868453564370982275146538346818193025553907658000194", 10 );
	mpz_set_str( xPB1, "2609681846899599530130767943505625038920442511812753799362914615298555444199837065310339118025943894695870263895982450584515296674886287887586129145481851", 10 );
	mpz_set_str( xQB0, "1520932988280900737101477887343261937071185643464137138286953195013205989746299342833710279816289338912858069348231690183198929976990068247400916779969343", 10 );
	mpz_set_str( xQB1, "6314227064240115853958946151179977579390312873271802880452808010281674064652679103864201213470949349390012982505292405538477672602421754887815611959982395", 10 );
	mpz_set_str( xRB0, "4342179899017882579533079890223028058023909900865764744870619904776458538521238727375188559019964798018092199915424773507087249866747843050889366214276810", 10 );
	mpz_set_str( xRB1, "6192843882433696826954649453457425444523562865348596678586681371393508409923315251518439153629623567059081337622145526296245902685629406249744403823399371", 10 );
*/

// TEST PARAMETERS WITH PRIMES 13 AND 17
/*
	int lA = 13;
	int lB = 17;
	int eA = 68;
	int eB = 62;
	int f = 56;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "3187515596976279820317474530060682949167073769394007202366706657855013810755040353129489849642303521881143419327128524808719147939668389021510590612334782", 10 );
	mpz_set_str( xPA1, "4450702596749551963250232535586887495335848390339449913413134930982326798161338043525300618018633589172688827307805564277328662248751217561283677044151884", 10 );
	mpz_set_str( xQA0, "5833760471683473736814117697048726780958080126422042023465385714793446900482621031575253250791235486847111095244695493376756851877633781007740945760680882", 10 );
	mpz_set_str( xQA1, "5258649757926672913122797675979272566136887956790317073138096405613630701211424690641411548460018633614366859929419078743950146932020335719246678763289797", 10 );
	mpz_set_str( xRA0, "5456739426206433396127971544332617304383263704321626928231261569994404534207057169841289880516031642765018597379912972596068726576763035681108606788823236", 10 );
	mpz_set_str( xRA1, "3220200914424081232369281427598849129254011363726893022505725551683828119841587366443018161558080658932985772181299156380307063598066077398363645724767409", 10 );
	
	mpz_set_str( xPB0, "5593695927994732396015348350900422019375868701101742478268792062778819518215040847498338192337993193149311863528767312239734070216003918340736260330609110", 10 );
	mpz_set_str( xPB1, "2264175920594313352795800704928744745684598385768888651519858126718229031737376671154750998896170423015215695271154709764383462320957516296592427197796695", 10 );
	mpz_set_str( xQB0, "5937401921322820019105552742463683507760183865420246362743969802754774978106714485341319486168860043602160116101407424764214292900812689627798728401949571", 10 );
	mpz_set_str( xQB1, "2581333790947007893825587786670798388075487719975790361500067072829160065111074775898941549210934282838462557214030796596189752371656112553486448056273061", 10 );
	mpz_set_str( xRB0, "3796659118246513565352897729584157642848379454749772568815577641695941105658905472295709944001242603445597566373329512059008727395552202969636310870740564", 10 );
	mpz_set_str( xRB1, "1371288386615288083211107855884515499346316897012671114718673655667023036387703989872884213400628669580600100787055951588992695982195921559657522392655934", 10 );
*/

// TEST PARAMETERS WITH PRIMES 13 AND 19
/*
	int lA = 13;
	int lB = 19;
	int eA = 68;
	int eB = 59;
	int f = 80;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "8176743683706197294660659946754473185489488769448524265937688872114967994717187663996167612039614842576754261896475181349946518374918506894279141878297", 10 );
	mpz_set_str( xPA1, "1115365332691468809356492387262780434834622703907418627041153785117474558387603683633528818277804332053182931946271166515744669335782643427825810483694058", 10 );
	mpz_set_str( xQA0, "194833078488210164702664835209896091392310174243929017086659525731483144414742895946524689737965320306163011092493222209383519923480681791236586363257101", 10 );
	mpz_set_str( xQA1, "689515961279291970125748375647690146513780465989045770836427941858944574376408246313995713156238784711899842285167315424295130323765316322448116952923609", 10 );
	mpz_set_str( xRA0, "645238310305103201083270802438480849553077955292970715944459246365633466054478159460712318823220399250314396819497573936988663222126012962151412603848666", 10 );
	mpz_set_str( xRA1, "953666957865103186456460563357299488543688104242750836463556424079311288622742691602267852089640676045482699882379243374390414746193804514746733646179006", 10 );
	
	mpz_set_str( xPB0, "907822438029255671248343009331718911713012961682703399443148759770671298224734781166702823307983123186902008432826791813876514875408269322907809896282121", 10 );
	mpz_set_str( xPB1, "188462030408708494976833439774629874231831265487942167503531834713904396835698731174870289361187939680645673261783108681260164658637246795699223007488651", 10 );
	mpz_set_str( xQB0, "909582178067939999234915095195169005326231935676009817081553258327793189964889279129904913712228295761050172804644733371240196423253746671858780675688995", 10 );
	mpz_set_str( xQB1, "950875520645502654990732328130348021065944269277964117038646990628487995366073694757885303295715270933201307173221299358158432556158125038865673368205764", 10 );
	mpz_set_str( xRB0, "757892766041207755447631973909342830846876480811922428538048118646087638488087978169423318841814236421314357200070584147053846735055753475548489014367289", 10 );
	mpz_set_str( xRB1, "490142477783075345578509930758031484446906020967937516916435667963222836906115165655227685701225909351150784195075477358929366995026892049237579811518033", 10 );
*/

// TEST PARAMETERS WITH PRIMES 17 AND 19
/*
	int lA = 17;
	int lB = 19;
	int eA = 62;
	int eB = 59;
	int f = 2280;
	mpz_t tmp1, tmp2;
	mpz_inits(tmp1, tmp2, NULL);
	mpz_ui_pow_ui(tmp1, lA, eA);
	mpz_ui_pow_ui(tmp2, lB, eB);
	mpz_mul(p, tmp1, tmp2);
	mpz_mul_ui(p, p, f);
	mpz_sub_ui(p, p, 1);
	set_prime( &param, p, lA, lB, eA, eB );
	mpz_clears(tmp1, tmp2, NULL);

	mpz_set_ui( alpha0, 0);
	mpz_set_ui( alpha1, 1);

	mpz_set_str( xPA0, "75767386921687563954382246957480390566091756448531027343368883262153926041775930227706578786352002040453162683542647539523751762142599273088995019162479683", 10 );
	mpz_set_str( xPA1, "82531027633471007470922558997518613290417669094931672143298238889968128966543720362873903220778021870510000103891578433031279256704739245594849066836969425", 10 );
	mpz_set_str( xQA0, "15223820678511507419935262256009208499660814906392616544074083374445747150543703263713461110403284477505374550417430842617996962890246195840535051554209375", 10 );
	mpz_set_str( xQA1, "15557620936275047296404003532622792705188929250462465423926347244741908491219174699716565804108159246670411010817078527946012011715504662079662478552044902", 10 );
	mpz_set_str( xRA0, "25090303676240852222351446742021330262591338041423720963229962650682274610314979286177404798600115055604317632020615640893484893558368636678195135123760146", 10 );
	mpz_set_str( xRA1, "40606203235653766202074400733744610650899231302471233332514300517130126454998424110802660762361262823549040842672590014076880280840736712070891424981247144", 10 );
	
	mpz_set_str( xPB0, "56144265636785737002705162195063309316687538388744938157540483113860177271197482019982174619625369086968442628075469805205793729812761000499358514255325497", 10 );
	mpz_set_str( xPB1, "67164697582174169964681571516235767147233288719166659542013657011345099766049248886279478430865880999937712505239452439730181132921014567600324480091582460", 10 );
	mpz_set_str( xQB0, "82702058542964574962341011623269711695747226626943354927430600850638368855831301972198598973527066039416337391110362479030871958098407664350918551784912876", 10 );
	mpz_set_str( xQB1, "109112643425106006623845180056020821281927578635602151088259956543759940435388182794145249548412853505849180910024934725250113287633791085710359601413018221", 10 );
	mpz_set_str( xRB0, "25591410141658103871566374261124812707747287685405098183434517761177743138393610891721826310395436471028063025198079288501605044483849491568613229177526196", 10 );
	mpz_set_str( xRB1, "76940038708382690616101916585984523165391740422379234647302927863334784255499667969358824304858598132469123258932632694314047130924587576876889535399718175", 10 );
*/


// END OF PARAMETERS DEFINITION

	mpz_set_str( secret_A, "4", 10 ); // secret_A in {1, ..., 2^eA-1}. 
	mpz_set_str( secret_B, "7", 10 ); // secret_B in {1, ..., 2^eB-1}. 

	int regular = (lA == 2); // to run the right function below, with 2/3 or lA/lB.
	set_points( &param, 
		alpha0, alpha1,
		xPA0, xPA1, xQA0, xQA1, xRA0, xRA1,
	 	xPB0, xPB1, xQB0, xQB1, xRB0, xRB1 );

	sk_init( &SKA, secret_A );
	pk_init_none( &PKA );
	sk_init( &SKB, secret_B );
	pk_init_none( &PKB );

	fp2 jA, jB;
	fp2_init_none(&jA);
	fp2_init_none(&jB);

	key_gen_Alice( &PKA, &SKA, &param, regular );
	key_gen_Bob( &PKB, &SKB, &param, regular );
	printf("Alice's public key is : \n");
	pk_print(&PKA);
	printf("Bob's public key is : \n");
	pk_print(&PKB);
	
	key_exchange_Alice( &jA, &SKA, &PKB, &param, regular );
	key_exchange_Bob( &jB, &SKB, &PKA, &param, regular );
	printf("jA : \n");
	fp2_print(&jA);
	printf("jB : \n");
	fp2_print(&jB);
	printf("\n");
	verification( &jA, &jB );
	
	fp2_clear( &jA );
	fp2_clear( &jB );
	pk_clear( &PKA );
	pk_clear( &PKB );
	sk_clear( &SKA );
	sk_clear( &SKB );
	//mpz_clears( tmp1, tmp2, NULL );
	mpz_clears( p, alpha0, alpha1,
		xQA0, xQA1, xPA0, xPA1, xRA0, xRA1, 
	 	xQB0, xQB1, xPB0, xPB1, xRB0, xRB1, 
	 	secret_A, secret_B, NULL );
	clear_parameters( &param );

}

void key_gen_Alice( pk *PKA, sk *SKA, parameters *param, int regular ) {
	/* Key_generation for Alice. Given a secret key SKA and public parameters param,
	sets PKA to the associated public key.
	Uses algorithms for 2/3 only if regular is set to 1.
	*/
	if( regular ){
		isogen_two( PKA, SKA, param );
	}
	else{
		isogen_Alice( PKA, SKA, param );
	}
}

void key_gen_Bob( pk *PKB, sk *SKB, parameters *param, int regular ) {
	/* Key_generation for Bob. Given a secret key SKB and public parameters param,
	sets PKB to the associated public key.
	Uses algorithms for 2/3 only if regular is set to 1.
	*/
	if( regular ){
		isogen_three( PKB, SKB, param );
	}
	else{
		isogen_Bob( PKB, SKB, param );
	}
}

void key_exchange_Alice( fp2 *jA, sk *SKA, pk *PKB, parameters *param, int regular ) {
	/* Key exchange for Alice. Given Bob's public key PKB, Alice's own secret key SKA and
	public parameters param, sets jA to the shared j-invariant jA.
	Uses algorithms for 2/3 only if regular is set to 1.
	*/
	if( regular ){
		isoex_two( jA, SKA, PKB, param );
	}
	else{
		isoex_Alice( jA, PKB, SKA, param );
	}
}

void key_exchange_Bob( fp2 *jB, sk *SKB, pk *PKA, parameters *param, int regular ) {
	/* Key exchange for Bob. Given Alice's public key PKA, Bob's own secret key SKB and
	public parameters param, sets jB to the shared j-invariant jB.
	Uses algorithms for 2/3 only if regular is set to 1.
	*/
	if( regular ){
		isoex_three( jB, SKB, PKA, param );
	}
	else{
		isoex_Bob( jB, PKA, SKB, param );
	}
}

void verification( fp2 *jA, fp2 *jB ) {
	/* Checks if jA and jB are equal over Fp2.
	*/
	if( fp2_are_equal( jA, jB ) ){
		printf("Key exchange worked !! : )\n");
	}
	else{
		printf("Missed... Sorry :'( \n");
	}
}